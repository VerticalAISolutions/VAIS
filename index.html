<!DOCTYPE html>
<html lang="de">
<head>
    </head>
<body>
    <script>
        class Synthesizer {
            constructor(id) {
                this.id = id;
                this.isPlaying = false;
                this.currentWaveform = 'sine';
                this.audioContext = null; // Initialize to null
                this.oscillator = null;
                this.gainNode = null;
                this.analyser = null;
                this.bufferLength = null;
                this.dataArray = null;
                this.visualizer = null;
                this.canvas = null;
                this.canvasCtx = null;

                try {  // Try to create the audio context
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    this.analyser = this.audioContext.createAnalyser();
                    this.analyser.fftSize = 2048;
                    this.bufferLength = this.analyser.frequencyBinCount;
                    this.dataArray = new Uint8Array(this.bufferLength);
                    this.visualizer = document.getElementById(`visualizer${this.id}`);
                    this.canvas = document.createElement('canvas');
                    this.canvasCtx = this.canvas.getContext('2d');
                    this.visualizer.appendChild(this.canvas);
                    this.canvas.width = this.visualizer.offsetWidth;
                    this.canvas.height = this.visualizer.offsetHeight;

                    this.gainNode = this.audioContext.createGain();
                    this.gainNode.connect(this.analyser);
                    this.analyser.connect(this.audioContext.destination);
                    this.gainNode.gain.value = 0; // Initialize volume to 0

                    this.setupEventListeners();
                    this.drawVisualizer();
                } catch (error) {
                    console.error("Error initializing AudioContext:", error);
                    alert("Your browser does not support Web Audio API or there was another problem with the AudioContext.");
                }
            }


            createOscillator() {
                if (!this.audioContext) return; // Exit if AudioContext is not available

                if (this.oscillator) {
                    this.oscillator.stop();
                    this.oscillator.disconnect();
                }

                try { // Put oscillator creation in a try/catch block
                    this.oscillator = this.audioContext.createOscillator();
                    this.oscillator.type = this.currentWaveform;
                    this.oscillator.frequency.value = document.getElementById(`frequency${this.id}`).value;
                    this.oscillator.connect(this.gainNode);

                    this.gainNode.gain.setValueAtTime(0.0001, this.audioContext.currentTime);
                    this.gainNode.gain.exponentialRampToValueAtTime(1, this.audioContext.currentTime + 0.05);

                    this.oscillator.start();
                } catch (error) {
                    console.error("Error creating oscillator:", error);
                }
            }

            setupEventListeners() {
                // ... (Your event listener code - no changes needed)
            }

            drawVisualizer() {
                if (!this.audioContext) return; // Exit if AudioContext is not available
                // ... (Your visualizer code - no changes needed)
            }
        }


        const synth1 = new Synthesizer(1);
        const synth2 = new Synthesizer(2);
        const synth3 = new Synthesizer(3);

        // ... (Your Freesound API interaction code) ...

    </script>
</body>
</html>
